# StarDist 算法原理笔记

> 编写时间：2025-07-31  
> 用途：细胞核实例分割  
> 来源论文：*Cell Detection with Star-convex Polygons*  
> 链接：[arXiv:1806.03535](https://arxiv.org/pdf/1806.03535)  

---

## 1. 方法简介

StarDist 通过“中心点 + 多方向射线”的星形几何建模完成实例分割：训练时将掩码重构为中心概率图与射线距离图两类标签；推理时网络同时输出中心概率与射线长度，结合阈值与 NMS 提取中心点，并以极坐标将射线还原为边界点序列，从而重建目标轮廓。

---

## 2. 方法结构

### 2.1 标签构建（训练阶段）

训练时为每个实例构建两类标签：

**中心概率图**: 每个实例计算一个中心点（质心或几何中心）; 构建全图的中心概率图，该像素为中心的位置置为 1，其余为 0

**射线距离图**: 以中心点为起点，发出 $n$ 条射线，角度均匀分布：
  
  $$
  \theta_k = \frac{2\pi k}{n},\quad k = 0, 1, ..., n - 1
  $$

每条射线从中心向外搜索，直到遇到目标边界（掩码为 0）,记录每个方向上中心到边界的距离 $r_k$;

### 2.2 模型结构（预测阶段）

模型为双分支网络：

分支一：预测中心概率图, 该分支以每个像素为单位，预测其作为实例中心点的可能性，输出为与输入图像同尺寸的概率图。通过后续的阈值筛选与非极大值抑制（NMS）从中提取高置信度中心点，用作实例轮廓恢复的起始位置

分支二：预测每个像素点的射线长度向量 $[r_1, ..., r_n]$,该分支预测每个像素在多个固定角度方向上延伸至目标边界的距离，输出为多通道射线长度图。每个通道对应一个方向角，组成射线长度向量。结合中心点坐标，通过极坐标转换重建目标边界

---

## 3. 推理流程

### **3.1 中心点筛选**

根据预测的中心概率图，设定阈值筛选出候选中心点, 使用 NMS（非极大值抑制）去除相近冗余的点，保留关键中心位置

### **3.2 恢复轮廓边界**

对于每个被保留的中心点 $(x_c, y_c)$：先获取对应的预测射线长度向量 $[r_1, ..., r_n]$, 再利用极坐标转换公式，计算 $n$ 个轮廓点坐标：

  $$
  \begin{aligned}
  x_k &= x_c + r_k \cdot \cos(\theta_k) \\
  y_k &= y_c + r_k \cdot \sin(\theta_k)
  \end{aligned}
  $$

最终轮廓为：
  $$
  \{(x_k, y_k)\}_{k=0}^{n-1}
  $$
顺序连接这些点构成星形多边形实例边界。

> 补充说明：  
> 射线方向与轮廓点位置满足：
> $$
> \cos(\theta_k) = \frac{x_k - x_c}{r_k},\quad
> \sin(\theta_k) = \frac{y_k - y_c}{r_k}
> $$
---

> 笔记为 StarDist 算法结构与推理过程的梳理总结，用于医学图像实例分割任务参考。
